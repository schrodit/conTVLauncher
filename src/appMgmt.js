"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const electron_1=require("electron"),winston=require("winston"),cfgMgmt_1=require("./cfgMgmt"),extAppMgmt_1=require("./extAppMgmt"),spotifyApp_1=require("./spotifyApp");class appMgmt{constructor(t,e){this.app=t,this.home=e,this.activeTime=0,electron_1.globalShortcut.register("CommandOrControl+Backspace",()=>{this.extApp.appWin&&this.extApp.closeApp()}),electron_1.globalShortcut.register("F3",()=>{this.extApp.appWin&&this.extApp.closeApp()}),electron_1.globalShortcut.register("F4",()=>{this.app.quit()}),electron_1.globalShortcut.register("CommandOrControl+L",()=>{this.extApp.openScreensaver(),this.stopActive()}),electron_1.ipcMain.on("close-launcher",()=>{this.app.quit()}),electron_1.ipcMain.on("close-screensaver",()=>{this.extApp.screensaver.close(),this.startActive()}),electron_1.ipcMain.on("stop-active-time",()=>{this.startActive()}),electron_1.ipcMain.on("start-active-time",()=>{this.stopActive()}),electron_1.ipcMain.on("reset-active-time",()=>{this.activeTime=0})}initCfg(){this.cfg=new cfgMgmt_1.cfgMgmt(this),this.startActiveInterval()}initExtApp(){this.extApp=new extAppMgmt_1.extAppMgmt(this)}initLogger(){this.logger=new winston.Logger({transports:[new winston.transports.Console,new winston.transports.File({filename:this.home+"/.config/conTVLauncher/conTVLauncher.log",formatter:t=>t.timestamp()+" "+t.level.toUpperCase()+" "+(t.message?t.message:"")+(t.meta&&Object.keys(t.meta).length?"\n\t"+JSON.stringify(t.meta):"")})]})}initSpotify(){this.spotify=new spotifyApp_1.spotifyApp(this)}throwError(t){this.logger.error(t),this.win.webContents.send("on-error",t)}startActive(){this.logger.info("Start active time.."),this.activeTimer=!0,this.activeTime=0}stopActive(){this.activeTime=0,this.activeTimer=!1,this.logger.info("Active timer stopped  ..")}startActiveInterval(){this.startActive(),setInterval(()=>{this.activeTime>=60*this.cfg.getCfg().screensaver&&this.activeTimer?(this.extApp.openScreensaver(),this.activeTimer=!1):this.activeTime=this.activeTime+30},3e4)}}exports.appMgmt=appMgmt;